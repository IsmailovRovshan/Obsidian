# 1Ô∏è‚É£ –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥–µ–ª–∏ –≥–∞—Ä–∞–Ω—Ç–∏–∏ –¥–æ—Å—Ç–∞–≤–∫–∏

| –¢–µ—Ä–º–∏–Ω            | –ü–µ—Ä–µ–≤–æ–¥                | –ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è                                                               | –ö–∞–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è –≤ RabbitMQ                                                                                               |
| ----------------- | ---------------------- | ------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------ |
| **At-most-once**  | ¬´–Ω–µ –±–æ–ª–µ–µ –æ–¥–Ω–æ–≥–æ —Ä–∞–∑–∞¬ª | –°–æ–æ–±—â–µ–Ω–∏–µ **–º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ—Ç–µ—Ä—è–Ω–æ**, –Ω–æ **–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—Ä–æ–¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è**             | `autoAck = true` ‚Üí —Å–æ–æ–±—â–µ–Ω–∏–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–º —Å—Ä–∞–∑—É –ø—Ä–∏ –¥–æ—Å—Ç–∞–≤–∫–µ. –ï—Å–ª–∏ consumer —É–ø–∞–¥—ë—Ç ‚Äî –ø–æ—Ç–µ—Ä—è —Å–æ–æ–±—â–µ–Ω–∏—è –≤–æ–∑–º–æ–∂–Ω–∞ |
| **At-least-once** | ¬´–º–∏–Ω–∏–º—É–º –æ–¥–∏–Ω —Ä–∞–∑¬ª     | –°–æ–æ–±—â–µ–Ω–∏–µ **–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ—Ç–µ—Ä—è–µ—Ç—Å—è**, –Ω–æ **–º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑** | `autoAck = false` + `BasicAck`/`BasicNack` ‚Üí RabbitMQ –±—É–¥–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ, –ø–æ–∫–∞ –Ω–µ –ø–æ–ª—É—á–∏—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ |
| **Exactly-once**  | ¬´—Ä–æ–≤–Ω–æ –æ–¥–∏–Ω —Ä–∞–∑¬ª       | –°–æ–æ–±—â–µ–Ω–∏–µ **–±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω —Ä–∞–∑**, –Ω–∏ –ø–æ—Ç–µ—Ä—è–Ω–æ, –Ω–∏ –ø—Ä–æ–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–æ   | RabbitMQ **–Ω–µ —É–º–µ–µ—Ç —Å–∞–º –ø–æ–ª–Ω–æ—Å—Ç—å—é**. –ù—É–∂–Ω–æ: –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ consumer (—Å—á—ë—Ç—á–∏–∫, —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID, DLQ –∏ retry)    |

---

# 2Ô∏è‚É£ –ü—Ä–∏–º–µ—Ä—ã –Ω–∞ C#

## üîπ At-most-once

```csharp
// autoAck = true
_channel.BasicConsume(queue: "queueA", autoAck: true, consumer: consumer);

consumer.Received += (sender, ea) =>
{
    var message = Encoding.UTF8.GetString(ea.Body.ToArray());
    Console.WriteLine($"–ü–æ–ª—É—á–µ–Ω–æ: {message}");
    // –ù–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è, RabbitMQ —Å—á–∏—Ç–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å—Ä–∞–∑—É –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º
};
```

üìå –†–∏—Å–∫: –µ—Å–ª–∏ consumer —É–ø–∞–¥—ë—Ç ‚Äî —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ—Ç–µ—Ä—è–Ω–æ.  
‚úÖ –ü–ª—é—Å: –ø—Ä–æ—Å—Ç–∞—è –∏ –±—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞.

---

## üîπ At-least-once

```csharp
// autoAck = false
_channel.BasicConsume(queue: "queueA", autoAck: false, consumer: consumer);

consumer.Received += (sender, ea) =>
{
    try
    {
        var message = Encoding.UTF8.GetString(ea.Body.ToArray());
        Console.WriteLine($"–ü–æ–ª—É—á–µ–Ω–æ: {message}");
        _channel.BasicAck(ea.DeliveryTag, false); // –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º —É—Å–ø–µ—à–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É
    }
    catch
    {
        _channel.BasicNack(ea.DeliveryTag, false, requeue: true); // –≤–µ—Ä–Ω—ë–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å
    }
};
```

üìå –†–∏—Å–∫: –ø—Ä–∏ —Å–±–æ–µ consumer —Å–æ–æ–±—â–µ–Ω–∏–µ –º–æ–∂–µ—Ç **–¥–æ—Å—Ç–∞–≤–∏—Ç—å—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑**.  
‚úÖ –ü–ª—é—Å: –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞, —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è.

---

## üîπ Exactly-once (–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)

RabbitMQ **–Ω–µ –¥–∞—ë—Ç exactly-once ‚Äú–∏–∑ –∫–æ—Ä–æ–±–∫–∏‚Äù**, –ø–æ—ç—Ç–æ–º—É –Ω—É–∂–Ω–æ:

1. **–î–æ–±–∞–≤–ª—è—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –∫ –∫–∞–∂–¥–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é**:
    

```csharp
var props = _channel.CreateBasicProperties();
props.MessageId = Guid.NewGuid().ToString();
```

2. **–ù–∞ consumer –ø—Ä–æ–≤–µ—Ä—è—Ç—å, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–æ—Å—å –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ**:
    

```csharp
var messageId = ea.BasicProperties.MessageId;
if (processedIds.Contains(messageId))
{
    _channel.BasicAck(ea.DeliveryTag, false); // –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º, –Ω–æ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ
    return;
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞
processedIds.Add(messageId);
_channel.BasicAck(ea.DeliveryTag, false);
```

3. **–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å DLQ –∏ retry**, —á—Ç–æ–±—ã –∏—Å–∫–ª—é—á–∏—Ç—å –ø–æ—Ç–µ—Ä—é —Å–æ–æ–±—â–µ–Ω–∏–π.
    

‚úÖ –í –∏—Ç–æ–≥–µ: **—Å–æ–æ–±—â–µ–Ω–∏–µ –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω —Ä–∞–∑**, –¥–∞–∂–µ –µ—Å–ª–∏ consumer —É–ø–∞–¥—ë—Ç –∏–ª–∏ RabbitMQ –ø–æ–≤—Ç–æ—Ä–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç –µ–≥–æ.

---

# 3Ô∏è‚É£ –ì–¥–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è –∫–∞–∂–¥–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è

|–ì–∞—Ä–∞–Ω—Ç–∏—è|–ì–¥–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è|
|---|---|
|**At-most-once**|–ù–∞ —É—Ä–æ–≤–Ω–µ consumer: `autoAck = true`|
|**At-least-once**|–ù–∞ —É—Ä–æ–≤–Ω–µ consumer: `autoAck = false` + `BasicAck/BasicNack`|
|**Exactly-once**|–ù–∞ —É—Ä–æ–≤–Ω–µ **–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è/consumer**: –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞, —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ ID, DLQ, retry-–ª–æ–≥–∏–∫–∞|

---

# 4Ô∏è‚É£ –ö—Ä–∞—Ç–∫–∞—è –∞–Ω–∞–ª–æ–≥–∏—è –∏–∑ –∂–∏–∑–Ω–∏

- **At-most-once**: –∫—É—Ä—å–µ—Ä –æ—Ç–¥–∞–ª –ø–æ—Å—ã–ª–∫—É –∏ —É—à—ë–ª. –ï—Å–ª–∏ –∞–¥—Ä–µ—Å–∞—Ç –Ω–µ –¥–æ–º–∞ ‚Äî –ø–æ—Ç–µ—Ä—è–Ω–æ.
    
- **At-least-once**: –∫—É—Ä—å–µ—Ä –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –ø—ã—Ç–∞—Ç—å—Å—è –¥–æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ—Å—ã–ª–∫—É, –ø–æ–∫–∞ –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–¥—è—Ç –ø–æ–ª—É—á–µ–Ω–∏–µ. –ú–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ø—ã—Ç–æ–∫.
    
- **Exactly-once**: –∫—É—Ä—å–µ—Ä –¥–æ—Å—Ç–∞–≤–∏–ª –ø–æ—Å—ã–ª–∫—É –∏ –∞–¥—Ä–µ—Å–∞—Ç –ø—Ä–æ–≤–µ—Ä–∏–ª ID, —á—Ç–æ–±—ã –Ω–µ –ø—Ä–∏–Ω—è—Ç—å –µ—ë –¥–≤–∞–∂–¥—ã.
    

---

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, —è –º–æ–≥—É –Ω–∞—Ä–∏—Å–æ–≤–∞—Ç—å **—Å—Ö–µ–º—É –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–ª—è —ç—Ç–∏—Ö —Ç—Ä—ë—Ö –º–æ–¥–µ–ª–µ–π** —Å RabbitMQ, —á—Ç–æ–±—ã –±—ã–ª–æ –ø—Ä—è–º –≤–∏–∑—É–∞–ª—å–Ω–æ –ø–æ–Ω—è—Ç–Ω–æ.

–•–æ—á–µ—à—å —Ç–∞–∫—É—é —Å—Ö–µ–º—É?